<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Profile | TravelBD</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body { background-color: #f4f7f6; font-family: 'Poppins', sans-serif; }
        .profile-card { border: none; border-radius: 25px; overflow: hidden; box-shadow: 0 15px 35px rgba(0,0,0,0.1); background: #fff; }
        .profile-header { background: linear-gradient(135deg, #0d6efd, #0dcaf0); padding: 50px 0; text-align: center; color: white; }
        .profile-img-container { width: 120px; height: 120px; border-radius: 50%; border: 5px solid white; margin: -60px auto 15px; background: #eee; display: flex; align-items: center; justify-content: center; font-size: 3rem; color: #aaa; overflow: hidden; background-color: #fff; }
        .form-label { font-weight: 600; color: #555; font-size: 0.9rem; }
        .form-control { border-radius: 12px; padding: 12px; border: 1px solid #e0e0e0; background-color: #fcfcfc; }
        .form-control:focus { border-color: #0d6efd; box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.1); }
        .btn-update { background: linear-gradient(135deg, #0d6efd, #0b5ed7); border: none; border-radius: 15px; padding: 15px; font-weight: 600; transition: 0.3s; }
        .btn-update:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(13, 110, 253, 0.2); }
        .read-only-field { background-color: #f8f9fa !important; color: #888; cursor: not-allowed; }
    </style>
</head>
<body>

<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-7">
            <div class="profile-card">
                <div class="profile-header">
                    <h2 class="fw-bold">Admin Settings</h2>
                    <p class="opacity-75">Personalize your administrative information</p>
                </div>
                
                <div class="profile-img-container shadow-sm">
                    <i class="fas fa-user-shield"></i>
                </div>

                <div class="card-body p-5 pt-0">
                    <form id="profileForm">
                        <div class="row g-4">
                            <div class="col-md-12">
                                <label class="form-label">Full Name</label>
                                <input type="text" id="adminName" class="form-control read-only-field" readonly>
                                <small class="text-muted" style="font-size: 0.7rem;">Primary info from users table</small>
                            </div>

                            <div class="col-md-12">
                                <label class="form-label">Email Address</label>
                                <input type="email" id="adminEmail" class="form-control read-only-field" readonly>
                            </div>

                            <hr class="my-4 opacity-50">

                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-phone me-2 text-primary"></i>Phone Number</label>
                                <input type="text" id="adminPhone" class="form-control" placeholder="Enter phone number">
                            </div>

                            <div class="col-md-6">
                                <label class="form-label"><i class="fas fa-briefcase me-2 text-primary"></i>Designation</label>
                                <input type="text" id="adminPosition" class="form-control" placeholder="e.g. CEO, Manager">
                            </div>

                            <div class="col-md-12 mt-5">
                                <button type="submit" class="btn btn-primary w-100 btn-update">
                                    <i class="fas fa-save me-2"></i> Save Profile Changes
                                </button>
                                <div class="text-center mt-3">
                                    <a href="admin.html" class="text-decoration-none text-muted small">
                                        <i class="fas fa-arrow-left me-1"></i> Back to Dashboard
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const token = localStorage.getItem('token');

    // ১. প্রোফাইল ডাটা ফেচ করা [cite: 2026-02-18]
    window.onload = async () => {
        if (!token) window.location.href = "../login.html";

        try {
            const res = await fetch('https://tourist-guide-backend-zl1u.onrender.com/api/admin/profile', {
                headers: { 'Authorization': 'Bearer ' + token }
            });
            const data = await res.json();
            
            // ডাটাবেস থেকে পাওয়া তথ্য ইনপুটে বসানো
            document.getElementById('adminName').value = data.name;
            document.getElementById('adminEmail').value = data.email;
            document.getElementById('adminPhone').value = data.phone || "";
            document.getElementById('adminPosition').value = data.position || "";
        } catch (err) {
            console.error("Load failed:", err);
        }
    };

    // ২. ডাটা আপডেট করা [cite: 2026-02-18]
    document.getElementById('profileForm').onsubmit = async (e) => {
        e.preventDefault();
        const phone = document.getElementById('adminPhone').value;
        const position = document.getElementById('adminPosition').value;

        try {
            const res = await fetch('https://tourist-guide-backend-zl1u.onrender.com/api/admin/profile/update', {
                method: 'PUT',
                headers: { 
                    'Content-Type': 'application/json',
                    'Authorization': 'Bearer ' + token 
                },
                body: JSON.stringify({ phone, position })
            });

            if (res.ok) {
                alert("✅ Profile updated successfully! [cite: 2026-02-18]");
            } else {
                alert("❌ Update failed. Please try again.");
            }
        } catch (err) {
            console.error("Update error:", err);
        }
    };
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>